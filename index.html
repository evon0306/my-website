<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©•é‡ç¹³äº¤ç´€éŒ„è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .student-seat {
            min-height: 45px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            position: relative;
            padding: 2px;
        }
        .student-seat:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        .student-seat.completed {
            background: #dcfce7;
            border-color: #16a34a;
        }
        .student-seat.correction {
            background: #fef3c7;
            border-color: #f59e0b;
        }
        .student-seat.rename-mode {
            border-color: #a855f7;
            background: #faf5ff;
        }
        .seat-number {
            font-size: 16px;
            font-weight: bold;
            color: #374151;
            line-height: 1.2;
        }
        .seat-name {
            font-size: 10px;
            color: #6b7280;
            margin-top: 2px;
            text-align: center;
            cursor: pointer;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            line-height: 1.1;
            max-width: 100%;
        }
        .seat-name:hover {
            color: #3b82f6;
        }
        .completed-mark {
            position: absolute;
            top: 2px;
            right: 2px;
            color: #16a34a;
            font-size: 16px;
        }
        .correction-mark {
            position: absolute;
            top: 2px;
            right: 2px;
            color: #f59e0b;
            font-size: 16px;
        }
        .assignment-item {
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            min-width: 120px;
            flex-shrink: 0;
        }
        .assignment-item:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        .assignment-item.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        .name-input {
            width: 100%;
            text-align: center;
            font-size: 12px;
            border: 1px solid #3b82f6;
            border-radius: 4px;
            padding: 2px;
            background: white;
        }
        .seat-name-only {
            font-size: 18px;
            color: #3b82f6;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
        }

        .resizer {
            width: 8px;
            background: #e5e7eb;
            cursor: col-resize;
            position: relative;
            transition: background-color 0.2s;
        }
        .resizer:hover {
            background: #9ca3af;
        }
        .resizer::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 20px;
            background: #6b7280;
            border-radius: 1px;
        }
        .main-panels {
            display: flex;
            gap: 0;
            height: 500px;
        }
        .left-panel {
            flex: 1;
            min-width: 200px;
            overflow: hidden;
        }
        .right-panel {
            width: 320px;
            min-width: 150px;
            overflow: hidden;
        }
        @media (max-width: 640px) {
            .main-panels {
                display: block;
                height: auto;
            }
            .left-panel, .right-panel {
                width: 100%;
                min-width: auto;
                height: 300px;
            }
            .student-seat {
                min-height: 35px;
            }
            .seat-name-only {
                font-size: 14px;
            }
            .seat-number {
                font-size: 14px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- æ¨™é¡Œå€ -->
    <div class="fixed top-0 left-0 right-0 bg-gray-50 z-50" style="height: 70px;">
        <div class="container mx-auto px-4 py-2 max-w-7xl h-full">
            <div class="flex items-center justify-between h-full">
                <!-- å·¦å´ï¼šæ—¥æœŸ -->
                <div>
                    <span id="currentDate" class="text-lg md:text-2xl font-bold text-gray-700"></span>
                </div>
                
                <!-- ä¸­é–“ï¼šæ¨™é¡Œ -->
                <div class="flex-1 text-center">
                    <h1 class="text-2xl md:text-4xl font-bold text-gray-800">è©•é‡ç¹³äº¤ç´€éŒ„è¡¨</h1>
                </div>
                
                <!-- å³å´ï¼šæ§åˆ¶é … -->
                <div class="hidden sm:flex items-center space-x-6">
                    <!-- ç­ç´šäººæ•¸ -->
                    <div class="flex items-center space-x-2">
                        <span class="text-sm font-medium text-gray-700">ç­ç´šäººæ•¸ï¼š</span>
                        <input type="number" id="studentCount" value="42" min="1" max="50" class="w-16 text-center border border-gray-300 rounded py-1 text-xs" onchange="updateStudentCount()">
                    </div>
                    
                    <!-- æ–°å¢è©•é‡ -->
                    <div class="flex items-center space-x-2">
                        <span class="text-sm font-medium text-gray-700">æ–°å¢è©•é‡ï¼š</span>
                        <input type="text" id="newAssignment" placeholder="è¼¸å…¥è©•é‡åç¨±" class="border border-gray-300 rounded px-3 py-1 w-32 text-xs">
                        <button onclick="addAssignment()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">æ–°å¢</button>
                    </div>
                    


                </div>
            </div>
            

        </div>
    </div>
    
    <!-- æ‰‹æ©Ÿç‰ˆæ§åˆ¶é … -->
    <div class="sm:hidden bg-white shadow-sm border-b px-4 py-3 fixed top-16 left-0 right-0 z-40">
        <div class="space-y-2">
            <div class="flex items-center justify-between space-x-4">
                <!-- ç­ç´šäººæ•¸ -->
                <div class="flex items-center space-x-2">
                    <span class="text-xs font-medium text-gray-700">äººæ•¸ï¼š</span>
                    <input type="number" id="studentCountMobile" value="42" min="1" max="50" class="w-12 text-center border border-gray-300 rounded py-1 text-xs" onchange="updateStudentCountMobile()">
                </div>
                
                <!-- æ–°å¢è©•é‡ -->
                <div class="flex items-center space-x-2 flex-1">
                    <input type="text" id="newAssignmentMobile" placeholder="è©•é‡åç¨±" class="border border-gray-300 rounded px-2 py-1 flex-1 text-xs">
                    <button onclick="addAssignmentMobile()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">æ–°å¢</button>
                </div>
            </div>
            


        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <div class="container mx-auto p-4 max-w-7xl md:pt-4" style="margin-top: 60px; padding-top: 20px;">
        
        <!-- è©•é‡æ¸…å–® -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <h2 class="text-lg font-semibold text-gray-800 mb-3 border-b pb-2">è©•é‡æ¸…å–®</h2>
            <div class="overflow-x-auto">
                <div id="assignmentList" class="flex gap-3 min-w-max">
                    <div class="text-gray-500 text-center py-8 text-sm w-full">å°šç„¡è©•é‡é …ç›®</div>
                </div>
            </div>
        </div>
        
        <!-- ä¸»è¦å…§å®¹å€ -->
        <div class="main-panels mb-4 sm:flex sm:gap-0 space-y-4 sm:space-y-0">
            <!-- å·¦æ¬„ï¼šå­¸ç”Ÿåº§ä½è¡¨ -->
            <div id="leftPanel" class="left-panel bg-white sm:rounded-l-lg rounded-lg shadow p-4 flex flex-col">
                <div class="flex items-center justify-between mb-3 border-b pb-2">
                    <h2 class="text-base md:text-lg font-semibold text-gray-800">å­¸ç”Ÿåå–®</h2>
                    <div class="flex space-x-2">
                        <button id="renameBtn" onclick="toggleRenameMode()" class="bg-purple-500 hover:bg-purple-600 text-white px-2 md:px-3 py-1 rounded text-xs md:text-sm">æ›´å</button>
                    </div>
                </div>
                <div class="text-xs text-gray-600 mb-3 hidden md:block">é»é¸è©•é‡å¾Œï¼Œå†é»é¸å­¸ç”Ÿå®Œæˆæ‰“å‹¾ã€‚æ›´åæ¨¡å¼ä¸‹é»é¸å­¸ç”Ÿå¯ä¿®æ”¹å§“åã€‚</div>
                <div class="overflow-y-auto flex-1">
                    <div id="studentGrid" class="grid gap-2" style="grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));">
                        <!-- å­¸ç”Ÿåº§è™Ÿå°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- åˆ†éš”ç·š -->
            <div id="resizer" class="resizer hidden sm:block"></div>
            
            <!-- å³æ¬„ï¼šæœªå®Œæˆå­¸ç”Ÿåå–® -->
            <div id="rightPanel" class="right-panel bg-white sm:rounded-r-lg rounded-lg shadow p-4 flex flex-col">
                <div class="flex items-center justify-between mb-3 border-b pb-2">
                    <h2 class="text-base md:text-lg font-semibold text-gray-800">æœªå®Œæˆåå–®</h2>
                </div>
                <div class="overflow-y-auto flex-1">
                    <div id="incompleteList" class="space-y-1">
                        <div class="text-gray-500 text-center py-8 text-sm">è«‹å…ˆé¸æ“‡è©•é‡</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç¼ºäº¤å€åŸŸ -->
        <div class="bg-white rounded-lg shadow p-4 flex flex-col resize" style="height: calc(100vh - 150px); min-height: 300px;" class="md:h-[calc(100vh-90px)]">
            <div class="flex items-center justify-between mb-3 border-b pb-2">
                <h2 class="text-base md:text-lg font-semibold text-gray-800">ç¼ºäº¤</h2>
            </div>
            <div class="overflow-y-auto flex-1">
                <div id="missingAssignmentsList" class="space-y-2">
                    <div class="text-gray-500 text-center py-8 text-sm">å°šç„¡è©•é‡é …ç›®</div>
                </div>
            </div>
        </div>
    </div>



    <script>
        let students = [];
        let assignments = [];
        let selectedAssignment = null;
        let editingStudent = null;
        let renameMode = false;

        // åˆå§‹åŒ–
        function init() {
            updateDate();
            loadAllData(); // è¼‰å…¥å„²å­˜çš„è³‡æ–™
            generateStudents();
            setInterval(updateDate, 1000);
        }

        // æ›´æ–°æ—¥æœŸ
        function updateDate() {
            const now = new Date();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            document.getElementById('currentDate').textContent = `${month}/${day}`;
        }



        // æ›´æ–°å­¸ç”Ÿäººæ•¸
        function updateStudentCount() {
            const count = parseInt(document.getElementById('studentCount').value);
            document.getElementById('studentCountMobile').value = count;
            generateStudents(count);
            autoSave(); // è‡ªå‹•å„²å­˜
        }

        // æ‰‹æ©Ÿç‰ˆæ›´æ–°å­¸ç”Ÿäººæ•¸
        function updateStudentCountMobile() {
            const count = parseInt(document.getElementById('studentCountMobile').value);
            document.getElementById('studentCount').value = count;
            generateStudents(count);
            autoSave(); // è‡ªå‹•å„²å­˜
        }

        // é è¨­å­¸ç”Ÿå§“å
        const defaultStudentNames = [
            'å¼µå“æ©', 'é»ç¥ä¸', 'å¼µç´¹é‹’', 'æ—æŸå»·', 'æ±ŸéŒ¥ç©', 'è˜‡éŸ‹å¯§', 'é»ƒç¿é€¸', 'æ¥Šå°¹å¾·', 
            'è¨±èŠè±', 'é™³èªå¸Œ', 'é™³ç•¯ç”«', 'æ¥Šè•å®‰', 'è¨±ç¨‹å®¥', 'æ–½å‰‡ç¿', 'è”¡ç§‰æ°', 'å¼µå®¶ç‘€', 
            'èƒ¡èŠè¯', 'å»–è­½çš“', 'æ–½è²å¦®', 'è¨±ä»¥æ¨‚', 'å‘‚æ¬£æ½”', 'é»ƒåšæš', 'æ–¹çªèŒµ', 'è¬å´´å®‡', 
            'è©¹äºè«¾', 'ç¿èª é™½', 'æ²ˆæ©ç¢©', 'å¼µåº­èª', 'æ–¹ç¥ºæ£®', 'è”¡çµä¼Š', 'é„­æ€ç¶­', 'å³æ‰¿è«º', 
            'æ›¹å®ˆæ££', 'å»–æŸæ·µ', 'é„­å®‡ç§§', 'å½­è³‡è˜‹', 'é­èˆ’å‰', 'å³åº­å¯¬', 'æ–½é›¨å½¤', 'å»–ç¦¹å–¬', 
            'é™³æ˜€äº®', 'æ—ç¾½è“'
        ];

        // è‡ªå‹•å„²å­˜æ©Ÿåˆ¶ - é˜²æŠ–å‹•å„²å­˜
        let saveTimeout = null;
        function autoSave() {
            // æ¸…é™¤ä¹‹å‰çš„å„²å­˜è¨ˆæ™‚å™¨
            if (saveTimeout) {
                clearTimeout(saveTimeout);
            }
            
            // è¨­å®šæ–°çš„å„²å­˜è¨ˆæ™‚å™¨ï¼ˆå»¶é²100mså„²å­˜ï¼Œé¿å…é »ç¹æ“ä½œï¼‰
            saveTimeout = setTimeout(() => {
                saveAllData();
            }, 100);
        }

        // é é¢é—œé–‰å‰è‡ªå‹•å„²å­˜
        window.addEventListener('beforeunload', function(e) {
            saveAllData();
        });

        // é é¢éš±è—æ™‚è‡ªå‹•å„²å­˜ï¼ˆä¾‹å¦‚åˆ‡æ›åˆ†é ï¼‰
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                saveAllData();
            }
        });

        // å®šæœŸè‡ªå‹•å„²å­˜ï¼ˆæ¯30ç§’ï¼‰
        setInterval(() => {
            saveAllData();
        }, 30000);

        // ç”Ÿæˆå­¸ç”Ÿ
        function generateStudents(count = 42) {
            const currentCount = students.length;
            
            if (count > currentCount) {
                // å¢åŠ å­¸ç”Ÿ
                for (let i = currentCount + 1; i <= count; i++) {
                    let savedName = localStorage.getItem(`student_${i}_name`);
                    
                    // å¦‚æœæ²’æœ‰å„²å­˜çš„å§“åï¼Œä½¿ç”¨é è¨­å§“å
                    if (!savedName && i <= defaultStudentNames.length) {
                        savedName = defaultStudentNames[i - 1];
                        localStorage.setItem(`student_${i}_name`, savedName);
                    }
                    
                    const student = {
                        id: i,
                        name: savedName || '',
                        completedAssignments: new Set(),
                        correctionAssignments: new Set()
                    };
                    
                    // å¦‚æœæœ‰å„²å­˜çš„å­¸ç”Ÿè³‡æ–™ï¼Œè¼‰å…¥å®Œæˆç‹€æ…‹
                    if (window.savedStudentsData) {
                        const savedStudent = window.savedStudentsData.find(s => s.id === i);
                        if (savedStudent) {
                            student.name = savedStudent.name || student.name;
                            student.completedAssignments = new Set(savedStudent.completedAssignments || []);
                            student.correctionAssignments = new Set(savedStudent.correctionAssignments || []);
                        }
                    }
                    
                    students.push(student);
                }
            } else if (count < currentCount) {
                // æ¸›å°‘å­¸ç”Ÿ
                students = students.slice(0, count);
            }
            
            // æ¸…é™¤æš«å­˜çš„å„²å­˜è³‡æ–™
            if (window.savedStudentsData) {
                delete window.savedStudentsData;
            }
            
            renderStudentGrid();
            updateIncompleteList();
            updateMissingAssignmentsList();
            renderAssignmentList(); // é‡æ–°æ¸²æŸ“è©•é‡æ¸…å–®ä»¥é¡¯ç¤ºæ­£ç¢ºçš„é¸ä¸­ç‹€æ…‹
        }

        // æ¸²æŸ“å­¸ç”Ÿåå–®
        function renderStudentGrid() {
            const grid = document.getElementById('studentGrid');
            grid.innerHTML = '';
            
            students.forEach(student => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'student-seat';
                studentDiv.dataset.studentId = student.id;
                
                const isCompleted = selectedAssignment && student.completedAssignments.has(selectedAssignment);
                const isCorrection = selectedAssignment && student.correctionAssignments.has(selectedAssignment);
                if (isCompleted) {
                    studentDiv.classList.add('completed');
                } else if (isCorrection) {
                    studentDiv.classList.add('correction');
                }
                if (renameMode) {
                    studentDiv.classList.add('rename-mode');
                }
                
                if (renameMode) {
                    studentDiv.innerHTML = `
                        <input type="text" value="${student.name}" 
                               onblur="updateStudentName(${student.id}, this.value)"
                               onkeypress="if(event.key==='Enter') this.blur()"
                               class="w-full text-center text-xs border border-purple-300 rounded px-1 py-0.5"
                               placeholder="${student.id}è™Ÿ">
                        ${isCompleted ? '<div class="completed-mark">âœ“</div>' : isCorrection ? '<div class="correction-mark">â–²</div>' : ''}
                    `;
                } else {
                    if (student.name) {
                        studentDiv.innerHTML = `
                            <div class="seat-name-only">${student.name}</div>
                            ${isCompleted ? '<div class="completed-mark">âœ“</div>' : isCorrection ? '<div class="correction-mark">â–²</div>' : ''}
                        `;
                    } else {
                        studentDiv.innerHTML = `
                            <div class="seat-number">${student.id}</div>
                            ${isCompleted ? '<div class="completed-mark">âœ“</div>' : isCorrection ? '<div class="correction-mark">â–²</div>' : ''}
                        `;
                    }
                    
                    studentDiv.onclick = () => handleSeatClick(student.id);
                }
                
                grid.appendChild(studentDiv);
            });
        }

        // ç·¨è¼¯å­¸ç”Ÿå§“å
        function editStudentName(studentId) {
            if (editingStudent === studentId) return;
            
            const student = students.find(s => s.id === studentId);
            const newName = prompt('è«‹è¼¸å…¥å­¸ç”Ÿå§“åï¼š', student.name);
            
            if (newName !== null && newName.trim()) {
                student.name = newName.trim();
                localStorage.setItem(`student_${studentId}_name`, student.name);
                renderStudentGrid();
                updateIncompleteList();
                updateMissingAssignmentsList();
            }
        }

        // æ›´æ–°å­¸ç”Ÿå§“å
        function updateStudentName(studentId, newName) {
            const student = students.find(s => s.id === studentId);
            student.name = newName.trim();
            localStorage.setItem(`student_${studentId}_name`, student.name);
            updateIncompleteList();
            updateMissingAssignmentsList();
            autoSave(); // è‡ªå‹•å„²å­˜
        }





        // è™•ç†åº§ä½é»æ“Š
        function handleSeatClick(studentId) {
            if (renameMode) {
                editStudentName(studentId);
            } else {
                toggleStudentCompletion(studentId);
            }
        }

        // è™•ç†å§“åé»æ“Š
        function handleNameClick(studentId, event) {
            event.stopPropagation();
            if (renameMode) {
                editStudentName(studentId);
            }
        }

        // åˆ‡æ›æ›´åæ¨¡å¼
        function toggleRenameMode() {
            renameMode = !renameMode;
            const btn = document.getElementById('renameBtn');
            if (renameMode) {
                btn.textContent = 'å®Œæˆ';
                btn.className = 'bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-sm';
            } else {
                btn.textContent = 'æ›´å';
                btn.className = 'bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm';
            }
            renderStudentGrid();
        }

        // å„²å­˜æ‰€æœ‰è³‡æ–™åˆ° localStorage
        function saveAllData() {
            try {
                // å„²å­˜è©•é‡æ¸…å–®
                localStorage.setItem('assignments', JSON.stringify(assignments));
                
                // å„²å­˜ç•¶å‰é¸ä¸­çš„è©•é‡
                localStorage.setItem('selectedAssignment', selectedAssignment || '');
                
                // å„²å­˜å­¸ç”Ÿå®Œæˆç‹€æ…‹
                const studentsData = students.map(student => ({
                    id: student.id,
                    name: student.name,
                    completedAssignments: Array.from(student.completedAssignments),
                    correctionAssignments: Array.from(student.correctionAssignments)
                }));
                localStorage.setItem('studentsData', JSON.stringify(studentsData));
                
                // å„²å­˜å­¸ç”Ÿäººæ•¸
                localStorage.setItem('studentCount', students.length.toString());
            } catch (error) {
                console.error('å„²å­˜è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
        }

        // å¾ localStorage è¼‰å…¥æ‰€æœ‰è³‡æ–™
        function loadAllData() {
            try {
                // è¼‰å…¥è©•é‡æ¸…å–®
                const savedAssignments = localStorage.getItem('assignments');
                if (savedAssignments) {
                    assignments = JSON.parse(savedAssignments);
                }
                
                // è¼‰å…¥ç•¶å‰é¸ä¸­çš„è©•é‡
                const savedSelectedAssignment = localStorage.getItem('selectedAssignment');
                if (savedSelectedAssignment && assignments.includes(savedSelectedAssignment)) {
                    selectedAssignment = savedSelectedAssignment;
                }
                
                // è¼‰å…¥å­¸ç”Ÿäººæ•¸
                const savedStudentCount = localStorage.getItem('studentCount');
                if (savedStudentCount) {
                    const count = parseInt(savedStudentCount);
                    document.getElementById('studentCount').value = count;
                    document.getElementById('studentCountMobile').value = count;
                }
                
                // è¼‰å…¥å­¸ç”Ÿå®Œæˆç‹€æ…‹
                const savedStudentsData = localStorage.getItem('studentsData');
                if (savedStudentsData) {
                    const studentsData = JSON.parse(savedStudentsData);
                    // é€™è£¡å…ˆè¼‰å…¥è³‡æ–™ï¼Œç¨å¾Œåœ¨ generateStudents ä¸­æœƒåˆä½µ
                    window.savedStudentsData = studentsData;
                }
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
        }

        // åˆ‡æ›å­¸ç”Ÿå®Œæˆç‹€æ…‹
        function toggleStudentCompletion(studentId) {
            if (!selectedAssignment) {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹è©•é‡é …ç›®');
                return;
            }
            
            const student = students.find(s => s.id === studentId);
            const isCompleted = student.completedAssignments.has(selectedAssignment);
            const isCorrection = student.correctionAssignments.has(selectedAssignment);
            
            if (isCompleted) {
                // å·²å®Œæˆ -> æœªå®Œæˆ
                student.completedAssignments.delete(selectedAssignment);
                student.correctionAssignments.delete(selectedAssignment);
            } else if (isCorrection) {
                // è¨‚æ­£ä¸­ -> å®Œæˆ
                student.correctionAssignments.delete(selectedAssignment);
                student.completedAssignments.add(selectedAssignment);
            } else {
                // æœªå®Œæˆ -> è¨‚æ­£ä¸­
                student.correctionAssignments.add(selectedAssignment);
            }
            
            renderStudentGrid();
            updateIncompleteList();
            updateMissingAssignmentsList();
            autoSave(); // è‡ªå‹•å„²å­˜
        }

        // æ–°å¢è©•é‡
        function addAssignment() {
            const input = document.getElementById('newAssignment');
            const assignmentName = input.value.trim();
            
            if (!assignmentName) {
                alert('è«‹è¼¸å…¥è©•é‡åç¨±');
                return;
            }
            
            if (assignments.includes(assignmentName)) {
                alert('æ­¤è©•é‡å·²å­˜åœ¨');
                return;
            }
            
            assignments.unshift(assignmentName); // æ–°è©•é‡åŠ åˆ°æœ€å‰é¢
            input.value = '';
            document.getElementById('newAssignmentMobile').value = '';
            renderAssignmentList();
            updateMissingAssignmentsList();
            autoSave(); // è‡ªå‹•å„²å­˜
        }

        // æ‰‹æ©Ÿç‰ˆæ–°å¢è©•é‡
        function addAssignmentMobile() {
            const input = document.getElementById('newAssignmentMobile');
            const assignmentName = input.value.trim();
            
            if (!assignmentName) {
                alert('è«‹è¼¸å…¥è©•é‡åç¨±');
                return;
            }
            
            if (assignments.includes(assignmentName)) {
                alert('æ­¤è©•é‡å·²å­˜åœ¨');
                return;
            }
            
            assignments.unshift(assignmentName); // æ–°è©•é‡åŠ åˆ°æœ€å‰é¢
            input.value = '';
            document.getElementById('newAssignment').value = '';
            renderAssignmentList();
            updateMissingAssignmentsList();
            autoSave(); // è‡ªå‹•å„²å­˜
        }

        // æ”¯æ´ Enter éµæ–°å¢è©•é‡
        document.addEventListener('DOMContentLoaded', function() {
            const desktopInput = document.getElementById('newAssignment');
            const mobileInput = document.getElementById('newAssignmentMobile');
            
            if (desktopInput) {
                desktopInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addAssignment();
                    }
                });
            }
            
            if (mobileInput) {
                mobileInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addAssignmentMobile();
                    }
                });
            }
        });

        // æ¸²æŸ“è©•é‡æ¸…å–®
        function renderAssignmentList() {
            const list = document.getElementById('assignmentList');
            
            if (assignments.length === 0) {
                list.innerHTML = '<div class="text-gray-500 text-center py-8 text-sm w-full">å°šç„¡è©•é‡é …ç›®</div>';
                return;
            }
            
            list.innerHTML = '';
            assignments.forEach((assignment, index) => {
                const assignmentDiv = document.createElement('div');
                assignmentDiv.className = `assignment-item ${selectedAssignment === assignment ? 'selected' : ''}`;
                
                const completedCount = students.filter(s => s.completedAssignments.has(assignment)).length;
                const totalCount = students.length;
                
                const clickCount = deleteClickCount[assignment] || 0;
                let deleteButtonText = 'åˆªé™¤';
                let deleteButtonClass = 'text-red-500 hover:text-red-700 text-xs bg-red-50 hover:bg-red-100 px-1 py-0.5 rounded';
                
                if (clickCount === 1) {
                    deleteButtonText = 'å†æŒ‰2æ¬¡';
                    deleteButtonClass = 'text-orange-500 hover:text-orange-700 text-xs bg-orange-50 hover:bg-orange-100 px-1 py-0.5 rounded';
                } else if (clickCount === 2) {
                    deleteButtonText = 'ç¢ºèªåˆªé™¤';
                    deleteButtonClass = 'text-red-600 hover:text-red-800 text-xs bg-red-100 hover:bg-red-200 px-1 py-0.5 rounded font-medium';
                }
                
                assignmentDiv.innerHTML = `
                    <div class="text-center relative">
                        <div class="font-medium text-sm">${assignment}</div>
                        <div class="flex items-center justify-between mt-1">
                            <span class="text-xs text-gray-500">${completedCount}/${totalCount}</span>
                            <button onclick="event.stopPropagation(); removeAssignment(${index})" class="${deleteButtonClass}">${deleteButtonText}</button>
                        </div>
                    </div>
                `;
                
                assignmentDiv.onclick = (e) => {
                    if (e.target.tagName === 'BUTTON') return;
                    selectAssignment(assignment);
                };
                
                list.appendChild(assignmentDiv);
            });
        }

        // é¸æ“‡è©•é‡
        function selectAssignment(assignment) {
            selectedAssignment = assignment;
            renderAssignmentList();
            renderStudentGrid();
            updateIncompleteList();
            autoSave(); // è‡ªå‹•å„²å­˜
        }

        // åˆªé™¤è©•é‡ - éœ€è¦é€£é»3ä¸‹
        let deleteClickCount = {};
        let deleteTimeout = {};
        
        function removeAssignment(index) {
            const assignment = assignments[index];
            
            // åˆå§‹åŒ–é»æ“Šè¨ˆæ•¸
            if (!deleteClickCount[assignment]) {
                deleteClickCount[assignment] = 0;
            }
            
            deleteClickCount[assignment]++;
            
            // æ¸…é™¤ä¹‹å‰çš„è¶…æ™‚
            if (deleteTimeout[assignment]) {
                clearTimeout(deleteTimeout[assignment]);
            }
            
            if (deleteClickCount[assignment] >= 3) {
                // ç¬¬ä¸‰æ¬¡é»æ“Šï¼ŒåŸ·è¡Œåˆªé™¤
                delete deleteClickCount[assignment];
                delete deleteTimeout[assignment];
                
                // å¾é™£åˆ—ä¸­ç§»é™¤è©•é‡
                assignments.splice(index, 1);
                
                // å¾æ‰€æœ‰å­¸ç”Ÿçš„å®Œæˆè¨˜éŒ„ä¸­ç§»é™¤æ­¤è©•é‡
                students.forEach(student => {
                    student.completedAssignments.delete(assignment);
                    student.correctionAssignments.delete(assignment);
                });
                
                // å¦‚æœåˆªé™¤çš„æ˜¯ç•¶å‰é¸ä¸­çš„è©•é‡ï¼Œæ¸…é™¤é¸æ“‡
                if (selectedAssignment === assignment) {
                    selectedAssignment = null;
                }
                
                // é‡æ–°æ¸²æŸ“æ‰€æœ‰ç›¸é—œå…ƒä»¶
                renderAssignmentList();
                renderStudentGrid();
                updateIncompleteList();
                updateMissingAssignmentsList();
                autoSave(); // è‡ªå‹•å„²å­˜
            } else {
                // è¨­ç½®2ç§’å¾Œé‡ç½®è¨ˆæ•¸
                deleteTimeout[assignment] = setTimeout(() => {
                    deleteClickCount[assignment] = 0;
                    renderAssignmentList(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æŒ‰éˆ•æ–‡å­—
                }, 2000);
                
                // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æŒ‰éˆ•æ–‡å­—
                renderAssignmentList();
            }
        }

        // æ›´æ–°æœªå®Œæˆåå–®
        function updateIncompleteList() {
            const list = document.getElementById('incompleteList');
            
            if (!selectedAssignment) {
                list.innerHTML = '<div class="text-gray-500 text-center py-8 text-sm">è«‹å…ˆé¸æ“‡è©•é‡</div>';
                return;
            }
            
            const incompleteStudents = students.filter(s => 
                !s.completedAssignments.has(selectedAssignment)
            );
            
            if (incompleteStudents.length === 0) {
                list.innerHTML = '<div class="text-green-600 text-center py-8 text-sm font-medium">ğŸ‰ å…¨éƒ¨å®Œæˆï¼</div>';
                return;
            }
            
            list.innerHTML = '';
            list.className = 'grid gap-2 overflow-y-auto flex-1';
            list.style.gridTemplateColumns = 'repeat(auto-fit, minmax(80px, 1fr))';
            
            incompleteStudents.forEach(student => {
                const studentDiv = document.createElement('div');
                const isCorrection = student.correctionAssignments.has(selectedAssignment);
                
                if (isCorrection) {
                    studentDiv.className = 'student-seat bg-yellow-50 border-yellow-200';
                    studentDiv.innerHTML = `
                        <div class="seat-name-only text-yellow-600" style="font-size: 14px;">${student.name || `${student.id}è™Ÿ`}</div>
                    `;
                } else {
                    studentDiv.className = 'student-seat bg-red-50 border-red-200';
                    studentDiv.innerHTML = `
                        <div class="seat-name-only text-red-600" style="font-size: 14px;">${student.name || `${student.id}è™Ÿ`}</div>
                    `;
                }
                
                list.appendChild(studentDiv);
            });
        }

        // æ›´æ–°ç¼ºäº¤åå–®
        function updateMissingAssignmentsList() {
            const list = document.getElementById('missingAssignmentsList');
            
            if (assignments.length === 0) {
                list.innerHTML = '<div class="text-gray-500 text-center py-8 text-sm">å°šç„¡è©•é‡é …ç›®</div>';
                return;
            }
            
            list.innerHTML = '';
            
            // æ”¶é›†æ‰€æœ‰æœ‰ç¼ºäº¤æˆ–è¨‚æ­£çš„å­¸ç”Ÿ
            const studentsWithIssues = [];
            
            students.forEach(student => {
                const missingAssignments = assignments.filter(assignment => 
                    !student.completedAssignments.has(assignment) && !student.correctionAssignments.has(assignment)
                );
                
                const correctionAssignments = assignments.filter(assignment => 
                    student.correctionAssignments.has(assignment)
                );
                
                if (missingAssignments.length > 0 || correctionAssignments.length > 0) {
                    studentsWithIssues.push({
                        student: student,
                        missing: missingAssignments,
                        correction: correctionAssignments
                    });
                }
            });
            
            if (studentsWithIssues.length === 0) {
                list.innerHTML = '<div class="text-green-600 text-center py-8 text-sm font-medium">ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆæ‰€æœ‰è©•é‡ï¼</div>';
                return;
            }
            
            // å‰µå»ºç¶²æ ¼å®¹å™¨
            const gridContainer = document.createElement('div');
            gridContainer.className = 'grid gap-3';
            gridContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(120px, 1fr))';
            
            studentsWithIssues.forEach(item => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'bg-white border-2 rounded-lg p-3 cursor-pointer hover:shadow-md transition-all';
                
                // æ ¹æ“šç‹€æ…‹æ±ºå®šé‚Šæ¡†é¡è‰²
                if (item.missing.length > 0 && item.correction.length > 0) {
                    // æ—¢æœ‰ç¼ºäº¤åˆæœ‰è¨‚æ­£ - æ©˜è‰²
                    studentDiv.classList.add('border-orange-300', 'hover:border-orange-400');
                } else if (item.missing.length > 0) {
                    // åªæœ‰ç¼ºäº¤ - ç´…è‰²
                    studentDiv.classList.add('border-red-300', 'hover:border-red-400');
                } else {
                    // åªæœ‰è¨‚æ­£ - é»ƒè‰²
                    studentDiv.classList.add('border-yellow-300', 'hover:border-yellow-400');
                }
                
                let content = `
                    <div class="text-center mb-2">
                        <div class="font-medium text-gray-800 text-sm">${item.student.name || `${item.student.id}è™Ÿ`}</div>
                    </div>
                `;
                
                // é¡¯ç¤ºç¼ºäº¤é …ç›®
                if (item.missing.length > 0) {
                    content += `
                        <div class="mb-2">
                            <div class="text-xs font-medium text-red-600 mb-1">ç¼ºäº¤ï¼š</div>
                            <div class="text-xs text-red-500 leading-tight">
                                ${item.missing.join('ã€')}
                            </div>
                        </div>
                    `;
                }
                
                // é¡¯ç¤ºè¨‚æ­£é …ç›®
                if (item.correction.length > 0) {
                    content += `
                        <div class="mb-1">
                            <div class="text-xs font-medium text-yellow-600 mb-1">è¨‚æ­£ï¼š</div>
                            <div class="text-xs text-yellow-600 leading-tight">
                                ${item.correction.join('ã€')}
                            </div>
                        </div>
                    `;
                }
                
                studentDiv.innerHTML = content;
                
                // æ·»åŠ é»æ“Šäº‹ä»¶é¡¯ç¤ºè©³ç´°è³‡è¨Š
                studentDiv.onclick = () => {
                    let details = `${item.student.name || `${item.student.id}è™Ÿ`} çš„è©³ç´°ç‹€æ³ï¼š\n\n`;
                    
                    if (item.missing.length > 0) {
                        details += `ç¼ºäº¤é …ç›®ï¼š\n${item.missing.join('ã€')}\n\n`;
                    }
                    
                    if (item.correction.length > 0) {
                        details += `è¨‚æ­£é …ç›®ï¼š\n${item.correction.join('ã€')}`;
                    }
                    
                    alert(details);
                };
                
                gridContainer.appendChild(studentDiv);
            });
            
            list.appendChild(gridContainer);
        }
        
        // é¡¯ç¤ºå­¸ç”Ÿè©³ç´°è³‡è¨Š
        function showStudentDetails(studentName, missingAssignments, correctionAssignments, type) {
            let details = `${studentName} çš„è©³ç´°ç‹€æ³ï¼š\n\n`;
            
            if (missingAssignments.length > 0) {
                details += `ç¼ºäº¤é …ç›®ï¼š\n${missingAssignments.join('ã€')}\n\n`;
            }
            
            if (correctionAssignments.length > 0) {
                details += `è¨‚æ­£é …ç›®ï¼š\n${correctionAssignments.join('ã€')}`;
            }
            
            alert(details);
        }

        // é¢æ¿èª¿æ•´å¤§å°åŠŸèƒ½ - æ”¯æ´æ¡Œé¢å’Œå¹³æ¿
        function initResizer() {
            const resizer = document.getElementById('resizer');
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');
            let isResizing = false;

            // æ»‘é¼ äº‹ä»¶ï¼ˆæ¡Œé¢ï¼‰
            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
                e.preventDefault();
            });

            // è§¸æ§äº‹ä»¶ï¼ˆå¹³æ¿ï¼‰
            resizer.addEventListener('touchstart', (e) => {
                isResizing = true;
                document.addEventListener('touchmove', handleTouchMove);
                document.addEventListener('touchend', handleTouchEnd);
                e.preventDefault();
            });

            function handleMouseMove(e) {
                if (!isResizing) return;
                resizePanels(e.clientX);
            }

            function handleTouchMove(e) {
                if (!isResizing) return;
                e.preventDefault();
                const touch = e.touches[0];
                resizePanels(touch.clientX);
            }

            function resizePanels(clientX) {
                const container = document.querySelector('.main-panels');
                const containerRect = container.getBoundingClientRect();
                const mouseX = clientX - containerRect.left;
                
                const minLeftWidth = 200;
                const minRightWidth = 150;
                const maxLeftWidth = containerRect.width - minRightWidth - 8; // 8px for resizer
                
                let leftWidth = Math.max(minLeftWidth, Math.min(maxLeftWidth, mouseX));
                let rightWidth = containerRect.width - leftWidth - 8;
                
                leftPanel.style.flex = 'none';
                leftPanel.style.width = leftWidth + 'px';
                rightPanel.style.width = rightWidth + 'px';
            }

            function handleMouseUp() {
                isResizing = false;
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            }

            function handleTouchEnd() {
                isResizing = false;
                document.removeEventListener('touchmove', handleTouchMove);
                document.removeEventListener('touchend', handleTouchEnd);
            }
        }








        const key = 'studentsData';
let prev = null; // æ”¹æˆ nullï¼Œä¿è­‰ç¬¬ä¸€æ¬¡æ›´æ–°æœƒè¢«åµæ¸¬åˆ°
let counter = 0;

// å»ºç«‹é¡¯ç¤ºæ¡†
const box = document.createElement('div');
box.style.position = 'fixed';
box.style.bottom = '10px';
box.style.right = '10px';
box.style.padding = '5px 10px';
box.style.background = 'rgba(0,0,0,0.7)';
box.style.color = '#fff';
box.style.fontFamily = 'monospace';
box.style.zIndex = 9999;
box.style.borderRadius = '5px';
box.innerText = counter;
document.body.appendChild(box);

// ç›£æ¸¬æ›´æ–°
setInterval(() => {
  const curr = localStorage.getItem(key);
  if (curr !== prev) {
    prev = curr;
    counter = (counter + 1) % 100; // 0~99 å¾ªç’°
    box.innerText = counter;
  }
}, 300);


















        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        init();
        initResizer();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97964f91a481f1cc',t:'MTc1NjkxMzY2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
